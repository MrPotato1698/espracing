---
import Layout from "@/layouts/NormalLayout.astro";
import CardIndex from "@/sections/CardsIndex.astro";
// import DevZone from "@/sections/devZone.astro";

// ****************************************************************************
// Para mostrar la dev zone
import { supabase } from "@/db/supabase";
const { cookies, redirect } = Astro;

const url = Astro.url;

const code = url.searchParams.get("code");
// Si hay un código en la página principal, redirigir al callback
if (code) {
  window.location.href = `/api/auth/callback?code=${code}`;
}
const access_token = url.searchParams.get('access_token');
//console.log('url', url);
if(access_token) {
	const { pathname, search } = url;

	// console.log('pathname', pathname);
	// console.log('search', search);
	//redirect(`${pathname}${search}`);
}

//let devZone = false;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

// if (!accessToken || !refreshToken) {
//   devZone = false;
// }

// Set the session with the cookies
const { data: dataAuth, error: errorAuth } = await supabase.auth.setSession({
  refresh_token: refreshToken?.value ?? '',
  access_token: accessToken?.value ?? '',
});

// If there is an error, delete the cookies and redirect to login
if (errorAuth) {
  cookies.delete("sb-access-token", {
    path: "/",
  });
  cookies.delete("sb-refresh-token", {
    path: "/",
  });
}

const id = dataAuth?.user?.id || "";

const { data: userData, error: errorUserData } = await supabase
  .from('profiles')
  .select('email')
  .eq('id', id)
  .single();

// if(userData?.email === '') {
// 	devZone = true;
// }
// ****************************************************************************
---

<Layout title="ESP Racing: Inicio">
	<!-- {devZone ? <DevZone />: null} -->

	<section>
		<div class = "max-w-screen-xl px-4 mx-auto py-28 lg:items-center">
			<h1 class = "text-center bg-gradient-to-r from-primary via-[#fcba02] to-white bg-clip-text text-3xl font-extrabold text-transparent sm:text-5xl">
				ESP RACING: Tu comunidad de iniciación al mundo del Simracing
			</h1>
			<p class = "max-w-6xl mx-auto mt-4 text-justify sm:text-xl/relaxed">
				Llevamos ya tres años con la nueva gestión y creemos que la comunidad ha
				sabido adaptarse a los cambios que esta necesitaba, apostando por un grupo
				de personas comprometidas a un mismo proyecto, tanto usuarios del staff como
				con los propios pilotos, en definitiva mas sencilla y menos compleja, donde
				lo mas importante sea correr y el respeto en nuestras carreras, apostando
				por unas normas de convivencia mínimas, dentro y fuera de la pista, en
				nuestro Discord podrás encontrar toda la información que necesites..
			</p>
	</div>
	</section>
	<CardIndex />
</Layout>
