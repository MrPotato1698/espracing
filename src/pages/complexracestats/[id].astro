---
import Layout from "@/layouts/NormalLayout.astro";
import { supabase } from "@/db/supabase";

const { id } = Astro.params;
if (!id) return Astro.redirect("/404");

const {data: raceData} = await supabase
  .from('race')
  .select('name, championship!inner(name)')
  .eq('filename', id)
  .single();
---

<Layout title="ESP Racing: Estadisticas Completas">
  <button
      onclick="window.location.href = '/globalresults'"
      class="no-underline bg-[#19191c] rounded-xl my-4 font-medium text-white text-lg py-4 px-8 block mx-auto hover:text-[#0f0f0f] hover:bg-[#da392b]"
    >
      Volver atras
    </button>

  <div class="container mx-auto">
    <p class="py-4 w-11/12 mx-auto text-4xl font-bold text-center">
      Estadistica completas de {raceData?.championship.name}: {raceData?.name}
    </p>

    <div id="datosCircuito"></div>
    <div id="tablaResultados"></div>
    <div id="chartChangePosition" class="w-11/12 mx-auto mt-4 border-2 rounded-lg border-[#da392b]"></div>
    <div id="chartGaps" class="w-11/12 mx-auto mt-4 border-2 rounded-lg border-[#da392b]"></div>
    <div class="grid gap-2 mx-auto mt-4 sectorTables">
      <div id="tablaS1"></div>
      <div id="tablaS2"></div>
      <div id="tablaS3"></div>
      <div id="tablaS4"></div>
      <div id="tablaS5"></div>
    </div>
    <div id="tableIndividualLaps"></div>
  </div>
</Layout>

<script>
  import "@/pages/api/raceresults/getRaceResultsComplex.ts";
</script>

<style>
  /* AÃ±adir un estado de carga */
  .loading {
    opacity: 0.5;
    pointer-events: none;
  }

  .sectorTables {
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 1rem;
    @media (min-width: 800px) {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    @media (min-width: 1210px) {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>